{% trans_default_domain 'BreithbarbotCropperBundle' %}

{% block breithbarbot_cropper_bundle_cropper_type_widget %}
    {% spaceless %}
        <div class="avatar-view" title="{{ 'croppingTool'|trans }}">
            <img class="img-responsive img-thumbnail" src="{% if form.vars.value is not null %}{{ asset(form.vars.value.path) }}{% else %}/placeholder/{{ form._width.vars.value~'x'~form._height.vars.value }}{% endif %}" alt="Image cropped">
        </div>

        <script>
            $(document).ready(function () {
                {% if form.vars.value is null %}
                    {#$('.avatar-view img').attr('src', '/placeholder/{{ form._width.vars.value~'x'~form._height.vars.value }}');#}
                    DummyImage.generate();
                {% endif %}

                // Initializing cropper modal
                $('.avatar-view').on('click', function (e) {
                    // Variable
                    $avatarModal = $('#avatar-modal');

                    // Closure
                    $elem = $(this);

                    // Set current image
                    $avatarModal.find('.avatar-wrapper').empty().html('<img src="' + $elem.find('img').attr('src') + '" />');

                    // Set custom data
                    {% for key, item in form.children %}
                        {% if key not in ['_width', '_height'] %}
                            {% for key, item in item.vars.attr %}
                                $avatarModal.find('.custom-data').append('<input type="hidden" name="{{ key }}" value="{{ item }}">');
                            {% endfor %}
                        {% endif %}
                    {% endfor %}

                    // Open the cropper modal
                    $avatarModal.modal('show');
                });
            });
        </script>
    {% endspaceless %}
{% endblock %}
